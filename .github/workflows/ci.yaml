script: |
  set -x
  echo "===== DEPLOYMENT STARTED ====="

  echo "Who am I?"
  whoami

  echo "Docker version:"
  docker --version

  echo "Logging into Docker Hub..."
  echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

  echo "Pulling image..."
  docker pull ${{ secrets.DOCKER_USERNAME }}/${IMAGE_NAME}:latest

  echo "Stopping container..."
  docker stop $CONTAINER_NAME || true
  docker rm $CONTAINER_NAME || true

  echo "Running container..."
  docker run -d \
    --restart unless-stopped \
    --name $CONTAINER_NAME \
    -p 80:80 \
    ${{ secrets.DOCKER_USERNAME }}/${IMAGE_NAME}:latest

  echo "Health check..."
  sleep 5
  curl -f http://localhost

  echo "===== DEPLOYMENT SUCCESSFUL ====="
